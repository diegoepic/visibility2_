<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Gestionar (Offline)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- CSS locales (precacheados por sw.js) -->
  <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/main-responsive.css">
  <link rel="stylesheet" href="assets/css/offline.css">
  <style>
    .net-badge { margin-left: 6px; }
  </style>
</head>
<body>
  <div class="container" style="margin-top:15px;">
    <div id="headerInfo" class="well well-sm">Cargando…</div>

    <div id="wizard">
      <div id="step1" class="panel panel-default" style="display:none;">
        <div class="panel-heading"><strong>Paso 1:</strong> Estado</div>
        <div class="panel-body" id="step1Body"></div>
      </div>
      <div id="step2" class="panel panel-default" style="display:none;">
        <div class="panel-heading"><strong>Paso 2:</strong> Materiales</div>
        <div class="panel-body" id="step2Body"></div>
      </div>
      <div id="step3" class="panel panel-default" style="display:none;">
        <div class="panel-heading"><strong>Paso 3:</strong> Encuesta</div>
        <div class="panel-body" id="step3Body"></div>
      </div>
      <div class="text-right">
        <a class="btn btn-default" href="index_pruebas.php"><i class="fa fa-arrow-left"></i> Volver</a>
        <button id="btnBack" class="btn btn-default" disabled>&laquo; Anterior</button>
        <button id="btnNext" class="btn btn-primary" disabled>Siguiente &raquo;</button>
        <button id="btnFinish" class="btn btn-success" style="display:none;">Finalizar Gestión</button>
      </div>
    </div>
  </div>

  <!-- libs locales -->
  <script src="assets/plugins/jquery/jquery-3.7.1.min.js"></script>
  <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>


  <script>
    (function(){
      if (navigator.onLine) {
        var s1 = document.createElement('script');
        s1.src = "https://cdn.jsdelivr.net/npm/browser-image-compression@latest/dist/browser-image-compression.js";
        s1.async = true; document.head.appendChild(s1);

        var s2 = document.createElement('script');
        s2.src = "https://cdn.jsdelivr.net/npm/exifr/dist/full.umd.js";
        s2.async = true; document.head.appendChild(s2);
      }
    })();
  </script>

  <!-- Infra offline existente -->
  <script src="assets/js/db.js"></script>
  <script src="assets/js/offline-queue.js"></script>
  <script src="assets/js/v2_cache.js"></script>

  <!-- Lógica específica -->
  <script src="assets/js/gestionar_spa.js"></script>

  <!-- Registro del SW si entran directo a esta URL -->
  <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/visibility2/app/sw.js', { scope: '/visibility2/app/' })
    .then(function(reg){
      if (reg.waiting) reg.waiting.postMessage('SKIP_WAITING');
      reg.addEventListener('updatefound', function(){
        var nw = reg.installing;
        if (!nw) return;
        nw.addEventListener('statechange', function(){
          if (nw.state === 'installed' && navigator.serviceWorker.controller) {
            reg.waiting && reg.waiting.postMessage('SKIP_WAITING');
          }
        });
      });
    })
    .catch(function(){ /* silencioso */ });
}
  </script>
</body>
</html>
